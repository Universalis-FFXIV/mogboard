{% extends 'base.html.twig' %}

{% block body %}
    <div class="home">
        <div class="home-nav">
            {% if auth.online %}
            <div>
                <button type="button" data-tab="market_activity">
                    <img src="/i/game/hammer.png"> Home
                </button>
            </div>


            <h3><img src="/i/svg/bells-light.svg"> Alerts</h3>
            {% if auth.user.alertsPerItem %}
                <div>
                    {% for itemId, alerts in auth.user.alertsPerItem %}
                        {% if itemId %}
                            {% set item = game().item(itemId) %}
                            <button type="button" data-tab="alerts_{{ itemId }}" class="rarity-{{ item.Rarity }}">
                                {{ item.Name }}
                            </button>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <p>No alerts created.</p>
            {% endif %}


            <h3><img src="/i/svg/th-list-light.svg"> Lists</h3>
            <div>
                {% for list in auth.user.lists %}
                    <button type="button" data-tab="lists_{{ list.id }}">
                        {{ list.name }}
                    </button>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div>
            {% if maintenance().isCompanionMaintenance %}
                <div class="home-box2">
                    <strong class="text-red"><img src="/i/game/offline.png" height="16" style="vertical-align: middle"> Companion App is down for maintenance. No price/history updates at this time.</strong>
                </div>
            {% endif %}

            {% if auth.online %}
                <div class="home-tab open" id="market_activity">

                    <div class="alert-default">
                        <p>
                            Welcome to Mogboard.com
                        </p>
                        <p>
                            This site remains up for existing Patreons to allow them to obtain Prices and History
                            of items on many servers. It is not possible to obtain Patreon status to get
                            access to the "Update" functionality for the foreseeable future. Only existing
                            patreons who have <strong>already paid</strong> will continue to receive what
                            they are owed.
                        </p>

                        <hr>

                        <p>
                            Square-Enix ban accounts who uses their Companion API outside of the mobile app, if you
                            want prices, use their official app which you can find here:
                            <a href="https://na.finalfantasyxiv.com/companion/">https://na.finalfantasyxiv.com/companion/</a>.
                        </p>
                        <p>
                            Due to these bans, <strong>it is impossible to provide a FREE AUTO-UPDATING service</strong>.
                        </p>
                        <p>
                            Due to these bans, <strong>it is impossible to provide a REAL-TIME UPDATED MARKET FOR EVERYONE.</strong>
                        </p>
                        <p>
                            Due to these bans, there is 1 account left. Patrons have paid a month, they will
                            get their moneys worth.
                        </p>
                        <p>
                            Due to these bans, the site will be useless for the majority of people as prices will
                            not auto-update in the background. This Auto-Updating is classified as "disruptive" and "botting"
                            in the FFXIV TOS. The free service you all enjoyed was only available to you by
                            breaking the TOS. In the same way Wiki-Sites, Database Sites and other FFXIV tools all
                            break the Datamining TOS to provide you free services. They have the fortunate life
                            of not getting banned, I do not have that luxury.
                        </p>
                        <p>
                            - Vekien
                        </p>
                    </div>

                </div>

                {# Alerts #}
                {% for itemId, alerts in auth.user.alertsPerItem %}
                    <div class="home-tab" id="alerts_{{ itemId }}">
                        {% include 'Home/alert.html.twig' %}
                    </div>
                {% endfor %}

                {# Lists #}
                {% for list in auth.user.lists %}
                    <div class="home-tab" id="lists_{{ list.id }}">
                        {% include 'Home/list.html.twig' %}
                    </div>
                {% endfor %}
            {% else %}
                <div class="home-logged-out">
                    <div>
                        <img src="/i/brand/mogboard/mogboard_light.svg" height="42">
                    </div>
                    <br>
                    <strong>Become a member!</strong>
                    <br>
                    Create alerts, make lists, add your retainers and get a personalised home page feed!
                    <br><br>
                    <a href="{{ path('account_login_discord') }}" class="btn-login">Login via <strong>Discord</strong></a>
                </div>
            {% endif %}
        </div>
        <div>
            <div class="home-box home-trending">
                {% for itemId in popular_items %}
                    {% set item = game().item(itemId) %}
                    {% if item.ID is defined %}
                        <div>
                            <div>
                                <a href="{{ path('item_page', { itemId: itemId }) }}">
                                    <img src="{{ item.ID|icon2x }}">
                                </a>
                            </div>
                            <div>
                                <div>
                                    {% if item.LevelItem > 1 %}<em class="ilv">{{ item.LevelItem }}</em>{% endif %}
                                    <a href="{{ path('item_page', { itemId: itemId }) }}" class="rarity-{{ item.Rarity }}">{{ item.Name }}</a>
                                </div>
                                <small>{{ item.ItemSearchCategory.Name ?? '(Cannot be sold)' }}</small>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
