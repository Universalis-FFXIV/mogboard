<div class="market_update_times">
    {% for entry in update_times %}
    <div>
        <h4>{{ entry.name }}</h4>
        <div>{{ entry.updated|date }}</div>
    </div>
    {% endfor %}
</div>

{# CHEAPEST #}
<div class="cross_world_markets">
    <div class="cheapest">
        <h2>Cheapest High-Quality</h2>
        {% if item.CanBeHq %}
            {% if census._Global.Prices_CheapestHQ %}
            <div class="cheapest_price">
                <i class="xiv-Gil"></i>
                <em>{{ census._Global.Prices_CheapestHQ.Quantity|number_format }} x</em>
                <span class="cheapest_value">{{ census._Global.Prices_CheapestHQ.PricePerUnit|number_format }}</span>

                <span class="cheapest_price_info">
                    Server: <strong>{{ census._Global.Prices_CheapestHQ.Server }}</strong> -
                    Total: <strong>{{ census._Global.Prices_CheapestHQ.PriceTotal|number_format }}</strong>
                </span>
            </div>
            {% else %}
                No HQ for sale!
            {% endif %}
        {% else %}
            <p>Item has no High-Quality variant.</p>
        {% endif %}
    </div>
    <div class="cheapest">
        <h2>Cheapest Normal Quality</h2>
        {% if census._Global.Prices_CheapestNQ %}
        <div class="cheapest_price">
            <i class="xiv-Gil"></i>
            <em>{{ census._Global.Prices_CheapestNQ.Quantity|number_format }} x</em>
            <span class="cheapest_value">{{ census._Global.Prices_CheapestNQ.PricePerUnit|number_format }}</span>

            <span class="cheapest_price_info">
                Server: <strong>{{ census._Global.Prices_CheapestNQ.Server }}</strong> -
                Total: <strong>{{ census._Global.Prices_CheapestNQ.PriceTotal|number_format }}</strong>
            </span>
        </div>
        {% else %}
            <p>No Normal-Quality for sale.</p>
        {% endif %}
    </div>
</div>
<br><br>

{# Purchase History #}
<h6>Cross-World Purchase history</h6>
{% include 'Product/chart_hc.html.twig' with {
    chart: {
        id: 'history_global',
        series: [
            {
                name: '(High-Quality) Price Per Unit',
                data: census.All.HC_History_HQ,
            },
            {
                name: '(Normal Quality) Price Per Unit',
                data: census.All.HC_History_NQ,
            }
        ]
    }
} %}


{% set averagePricesNQ   = census._Global.Prices_Average_PricePerUnit_NQ %}
{% set averagePricesHQ   = census._Global.Prices_Average_PricePerUnit_HQ %}
{% set averageHistoryNQ  = census._Global.History_Average_PricePerUnit_NQ %}
{% set averageHistoryHQ  = census._Global.History_Average_PricePerUnit_HQ %}

{# CROSS WORLD MARKET BOARD #}
<div class="cross_world_markets">
    <div>
        {% if item.CanBeHq %}
            <h6><img src="/i/game/hq.png" height="15"> HQ Prices</h6>
            {% include 'Product/prices.html.twig' with {
                'prices': census._Global.PricesHQ|slice(0, 10),
                'crossWorld': true,
                'averagePricesNQ': averagePricesNQ,
                'averagePricesHQ': averagePricesHQ
            } %}
            <br>
        {% endif %}

        <h6>NQ Prices</h6>
        {% include 'Product/prices.html.twig' with {
            'prices': census._Global.PricesNQ|slice(0, 10),
            'crossWorld': true,
            'averagePricesNQ': averagePricesNQ,
            'averagePricesHQ': averagePricesHQ
        } %}
    </div>
    <div>
        {% if item.CanBeHq %}
            <h6><img src="/i/game/hq.png" height="15"> HQ Purchase History</h6>
            {% include 'Product/history.html.twig' with {
                'history': census._Global.HistoryHQ|slice(0, 10),
                'crossWorld': true,
                'averageHistoryNQ': averageHistoryNQ,
                'averageHistoryHQ': averageHistoryHQ
            } %}
            <br>
        {% endif %}

        <h6>NQ Purchase History</h6>
        {% include 'Product/history.html.twig' with {
            'history': census._Global.HistoryNQ|slice(0, 10),
            'crossWorld': true,
            'averageHistoryNQ': averageHistoryNQ,
            'averageHistoryHQ': averageHistoryHQ
        } %}
    </div>
</div>
<br><br>

{# AVERAGE PRICES AND HISTORY #}
<div class="cross_world_markets">
    <div>
        <div class="flex census_box">
            <div>
                <h5>Avg. Per Unit</h5>
                <br>
                <div class="flex avg_prices">
                    {% if item.CanBeHq %}
                    <div class="flex_50 price-hq">
                        <img src="/i/game/hq.png"> {{ census._Global.Prices_Average_PricePerUnit_HQ|number_format }}
                    </div>
                    {% endif %}
                    <div class="{{ item.CanBeHq ? 'flex_50' : 'flex_100' }}">
                        {{ census._Global.Prices_Average_PricePerUnit_NQ|number_format }}
                    </div>
                </div>
            </div>
            <div>
                <h5>Avg. Total</h5>
                <br>
                <div class="flex avg_prices">
                    {% if item.CanBeHq %}
                    <div class="flex_50 price-hq">
                        <img src="/i/game/hq.png"> {{ census._Global.Prices_Average_PriceTotal_HQ|number_format }}
                    </div>
                    {% endif %}
                    <div class="{{ item.CanBeHq ? 'flex_50' : 'flex_100' }}">
                        {{ census._Global.Prices_Average_PriceTotal_NQ|number_format }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div class="flex census_box">
            <div>
                <h5>Avg. Per Unit</h5>
                <br>
                <div class="flex avg_prices">
                    {% if item.CanBeHq %}
                    <div class="flex_50 price-hq">
                        <img src="/i/game/hq.png"> {{ census._Global.History_Average_PricePerUnit_HQ|number_format }}
                    </div>
                    {% endif %}
                    <div class="{{ item.CanBeHq ? 'flex_50' : 'flex_100' }}">
                        {{ census._Global.History_Average_PricePerUnit_NQ|number_format }}
                    </div>
                </div>
            </div>
            <div>
                <h5>Avg. Total</h5>
                <br>
                <div class="flex avg_prices">
                    {% if item.CanBeHq %}
                    <div class="flex_50 price-hq">
                        <img src="/i/game/hq.png"> {{ census._Global.History_Average_PriceTotal_HQ|number_format }}
                    </div>
                    {% endif %}
                    <div class="{{ item.CanBeHq ? 'flex_50' : 'flex_100' }}">
                        {{ census._Global.History_Average_PriceTotal_NQ|number_format }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<br><br>

{# PRICE VS QUANTITY #}
<div class="cross_world_markets">
    <div>
        <h6>Current - Price Per Unit vs Quantity</h6>
        <div class="cross_world_chart" style="position: relative; height: 350px; width: 100%"><canvas id="Prices_BubbleChart"></canvas></div>
        <script>
            renderChart(
                'Prices_BubbleChart',
                'bubble',
                [
                    'High-Quality',
                    'Normal Quality'
                ],
                1,
                {{ [
                    census._Global.Prices_BubbleChart_HQ|slice(0,chart_max)|length,
                    census._Global.Prices_BubbleChart_NQ|slice(0,chart_max)|length
                ]|max }},
                [
                    {{ census._Global.PricesQuantity_Chart_PricePerUnit_HQ|json_encode|raw }},
                    {{ census._Global.PricesQuantity_Chart_PricePerUnit_NQ|json_encode|raw }}
                ],
                {{ census._Global.Prices_BubbleChart_HQ|slice(0,chart_max)|json_encode|raw }},
                {{ census._Global.Prices_BubbleChart_NQ|slice(0,chart_max)|json_encode|raw }},
            );
        </script>
    </div>
    <div>
        <h6>History - Price Per Unit vs Quantity</h6>
        <div class="cross_world_chart" style="position: relative; height: 350px; width: 100%"><canvas id="History_BubbleChart"></canvas></div>
        <script>
            renderChart(
                'History_BubbleChart',
                'bubble',
                [
                    'High-Quality',
                    'Normal Quality'
                ],
                1,
                {{ [
                    census._Global.History_BubbleChart_HQ|slice(0,chart_max)|length,
                    census._Global.History_BubbleChart_NQ|slice(0,chart_max)|length
                ]|max }},
                [
                    {{ census._Global.HistoryQuantity_Chart_PricePerUnit_HQ|json_encode|raw }},
                    {{ census._Global.HistoryQuantity_Chart_PricePerUnit_NQ|json_encode|raw }}
                ],
                {{ census._Global.History_BubbleChart_HQ|slice(0,chart_max)|json_encode|raw }},
                {{ census._Global.History_BubbleChart_NQ|slice(0,chart_max)|json_encode|raw }},
            );
        </script>
    </div>
</div>

<br><br><br><br>
